<div style="display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 24px;">
  <div>
    <h2>Mis Tareas</h2>
    <p style="color: #94a3b8; font-size: 13px; margin-top: 3px;">Gestiona y organiza todas tus tareas</p>
  </div>
  <button mat-raised-button color="primary" (click)="createTask()">
    <mat-icon>add</mat-icon> Nueva Tarea
  </button>
</div>

<div style="display: flex; gap: 12px; margin-bottom: 20px; flex-wrap: wrap;">
  <div class="stat-card" style="flex: 1; min-width: 130px; background: white; border-radius: 14px; padding: 16px 18px; border: 1px solid #e2e8f0; box-shadow: 0 2px 8px rgba(0,0,0,0.04);">
    <p style="font-size: 10px; text-transform: uppercase; letter-spacing: 1px; color: #94a3b8; font-weight: 600;">Total</p>
    <p style="font-size: 26px; font-weight: 700; color: #1e293b; margin-top: 2px;">{{ tasks.length }}</p>
  </div>
  <div class="stat-card" style="flex: 1; min-width: 130px; background: white; border-radius: 14px; padding: 16px 18px; border: 1px solid #fcd34d; box-shadow: 0 2px 8px rgba(0,0,0,0.04);">
    <p style="font-size: 10px; text-transform: uppercase; letter-spacing: 1px; color: #d97706; font-weight: 600;">Pendientes</p>
    <p style="font-size: 26px; font-weight: 700; color: #d97706; margin-top: 2px;">{{ getPendingCount() }}</p>
  </div>
  <div class="stat-card" style="flex: 1; min-width: 130px; background: white; border-radius: 14px; padding: 16px 18px; border: 1px solid #93c5fd; box-shadow: 0 2px 8px rgba(0,0,0,0.04);">
    <p style="font-size: 10px; text-transform: uppercase; letter-spacing: 1px; color: #2563eb; font-weight: 600;">En Proceso</p>
    <p style="font-size: 26px; font-weight: 700; color: #2563eb; margin-top: 2px;">{{ getInProgressCount() }}</p>
  </div>
  <div class="stat-card" style="flex: 1; min-width: 130px; background: white; border-radius: 14px; padding: 16px 18px; border: 1px solid #6ee7b7; box-shadow: 0 2px 8px rgba(0,0,0,0.04);">
    <p style="font-size: 10px; text-transform: uppercase; letter-spacing: 1px; color: #059669; font-weight: 600;">Completadas</p>
    <p style="font-size: 26px; font-weight: 700; color: #059669; margin-top: 2px;">{{ getCompletedCount() }}</p>
  </div>
</div>

<div style="display: flex; gap: 14px; margin-bottom: 20px; flex-wrap: wrap; align-items: center; background: white; border-radius: 16px; padding: 14px 18px; border: 1px solid #e2e8f0; box-shadow: 0 2px 8px rgba(0,0,0,0.04);">
  <mat-form-field style="flex-grow: 1; min-width: 200px; margin-bottom: 0;">
    <mat-label>Buscar</mat-label>
    <input matInput [(ngModel)]="searchText" (keyup)="onSearch()" placeholder="Buscar por título...">
    <mat-icon matSuffix style="color: #94a3b8;">search</mat-icon>
  </mat-form-field>

  <div class="filter-buttons" style="display: flex; gap: 6px;">
    <button mat-raised-button [class.active]="selectedFilter === 'ALL'"        (click)="filterByStatus('ALL')">Todos</button>
    <button mat-raised-button [class.active]="selectedFilter === 'PENDING'"    (click)="filterByStatus('PENDING')">Pendientes</button>
    <button mat-raised-button [class.active]="selectedFilter === 'IN_PROGRESS'" (click)="filterByStatus('IN_PROGRESS')">En Proceso</button>
    <button mat-raised-button [class.active]="selectedFilter === 'COMPLETED'"  (click)="filterByStatus('COMPLETED')">Completadas</button>
  </div>
</div>

<mat-table [dataSource]="tasks" *ngIf="tasks.length > 0">

  <ng-container matColumnDef="id">
    <mat-header-cell *matHeaderCellDef>ID</mat-header-cell>
    <mat-cell *matCellDef="let task" style="color: #94a3b8; font-weight: 500;">#{{ task.id }}</mat-cell>
  </ng-container>

  <ng-container matColumnDef="title">
    <mat-header-cell *matHeaderCellDef>Título</mat-header-cell>
    <mat-cell *matCellDef="let task">
      <a href="#" (click)="$event.preventDefault(); viewTask(task.id)">{{ task.title }}</a>
    </mat-cell>
  </ng-container>

  <ng-container matColumnDef="status">
    <mat-header-cell *matHeaderCellDef>Estado</mat-header-cell>
    <mat-cell *matCellDef="let task">
      <span class="status-chip" [class]="getStatusColor(task.status)">{{ getStatusLabel(task.status) }}</span>
    </mat-cell>
  </ng-container>

  <ng-container matColumnDef="createdAt">
    <mat-header-cell *matHeaderCellDef>Creada</mat-header-cell>
    <mat-cell *matCellDef="let task" style="color: #94a3b8;">{{ task.createdAt | date:'dd/MM/yyyy HH:mm' }}</mat-cell>
  </ng-container>

  <ng-container matColumnDef="actions">
    <mat-header-cell *matHeaderCellDef>Acciones</mat-header-cell>
    <mat-cell *matCellDef="let task">
      <button mat-icon-button color="accent"  (click)="startTask(task.id)"    *ngIf="task.status === 'PENDING'"     matTooltip="Iniciar tarea">
        <mat-icon>play_arrow</mat-icon>
      </button>
      <button mat-icon-button color="primary" (click)="completeTask(task.id)" *ngIf="task.status === 'IN_PROGRESS'" matTooltip="Completar tarea">
        <mat-icon>check_circle</mat-icon>
      </button>
      <button mat-icon-button color="warn"    (click)="deleteTask(task.id)"   matTooltip="Eliminar tarea">
        <mat-icon>delete</mat-icon>
      </button>
    </mat-cell>
  </ng-container>

  <mat-header-row *matHeaderRowDef="displayedColumns"></mat-header-row>
  <mat-row *matRowDef="let row; columns: displayedColumns;"></mat-row>
</mat-table>

<div class="empty-state" *ngIf="tasks.length === 0">
  <mat-icon>inbox</mat-icon>
  <p>No hay tareas aún. ¡Crea una nueva!</p>
</div>
